<Window
    xmlns="http://schemas.microsoft.com/winfx/2006/xaml/presentation"
    xmlns:x="http://schemas.microsoft.com/winfx/2006/xaml"
    xmlns:d="http://schemas.microsoft.com/expression/blend/2008"
    xmlns:mc="http://schemas.openxmlformats.org/markup-compatibility/2006"
    xmlns:ignore="http://www.galasoft.ch/ignore"
    xmlns:stocks="clr-namespace:CashManager_MVVM.Features.Stocks"
    xmlns:properties="clr-namespace:CashManager_MVVM.Properties"
    xmlns:main="clr-namespace:CashManager_MVVM.Features.Main"
    x:Class="CashManager_MVVM.Features.Main.MainWindow"
    mc:Ignorable="d ignore"
    WindowStartupLocation="CenterScreen"
    Width="{Binding Source={x:Static properties:Settings.Default}, Path=Width, Mode=TwoWay}"
    Height="{Binding Source={x:Static properties:Settings.Default}, Path=Height, Mode=TwoWay}"
    Title="Cash Manager" Closed="OnClosed" WindowStyle="None" AllowsTransparency="True"
    d:DataContext="{d:DesignInstance Type=main:ApplicationViewModel, IsDesignTimeCreatable=True}">
    <Window.Resources>
        <ControlTemplate x:Key="Minimize" TargetType="{x:Type Button}">
            <Grid Width="40" Height="20" WindowChrome.IsHitTestVisibleInChrome="True">
                <VisualStateManager.VisualStateGroups>
                    <VisualStateGroup x:Name="CommonStates">
                        <VisualState x:Name="Normal"/>
                        <VisualState x:Name="MouseOver">
                            <Storyboard>
                                <ObjectAnimationUsingKeyFrames Storyboard.TargetProperty="(Shape.Fill)" Storyboard.TargetName="rectangle">
                                    <DiscreteObjectKeyFrame KeyTime="0" Value="{StaticResource HoverBorderAccentBrush}"/>
                                </ObjectAnimationUsingKeyFrames>
                                <ObjectAnimationUsingKeyFrames Storyboard.TargetProperty="(Shape.Stroke)" Storyboard.TargetName="rectangle">
                                    <DiscreteObjectKeyFrame KeyTime="0" Value="{StaticResource HoverBorderAccentBrush}"/>
                                </ObjectAnimationUsingKeyFrames>
                            </Storyboard>
                        </VisualState>
                        <VisualState x:Name="Pressed">
                            <Storyboard>
                                <ObjectAnimationUsingKeyFrames Storyboard.TargetProperty="(Shape.Stroke)" Storyboard.TargetName="rectangle">
                                    <DiscreteObjectKeyFrame KeyTime="0" Value="{StaticResource HoverBorderAccentBrush}"/>
                                </ObjectAnimationUsingKeyFrames>
                                <ObjectAnimationUsingKeyFrames Storyboard.TargetProperty="(Shape.Fill)" Storyboard.TargetName="rectangle">
                                    <DiscreteObjectKeyFrame KeyTime="0" Value="{StaticResource HoverBorderAccentBrush}"/>
                                </ObjectAnimationUsingKeyFrames>
                            </Storyboard>
                        </VisualState>
                        <VisualState x:Name="Disabled"/>
                    </VisualStateGroup>
                </VisualStateManager.VisualStateGroups>
                <Rectangle Fill="{DynamicResource BackgroundColorBrush}" HorizontalAlignment="Stretch" Height="Auto" VerticalAlignment="Stretch" Width="Auto"/>
                <Rectangle x:Name="rectangle" Fill="{DynamicResource BorderBrush}" HorizontalAlignment="Stretch" Height="3" VerticalAlignment="Center" Width="20" Stroke="{DynamicResource BorderBrush}"/>
            </Grid>
        </ControlTemplate>
        <ControlTemplate x:Key="Close" TargetType="{x:Type Button}">
            <Grid Width="40" Height="20" WindowChrome.IsHitTestVisibleInChrome="True">
                <VisualStateManager.VisualStateGroups>
                    <VisualStateGroup x:Name="CommonStates">
                        <VisualState x:Name="Normal"/>
                        <VisualState x:Name="MouseOver">
                            <Storyboard>
                                <ObjectAnimationUsingKeyFrames Storyboard.TargetProperty="(Shape.Fill)" Storyboard.TargetName="rectangle">
                                    <DiscreteObjectKeyFrame KeyTime="0" Value="{StaticResource BackgroundColorBrush}"/>
                                </ObjectAnimationUsingKeyFrames>
                                <ObjectAnimationUsingKeyFrames Storyboard.TargetProperty="(Shape.Fill)" Storyboard.TargetName="path">
                                    <DiscreteObjectKeyFrame KeyTime="0" Value="{StaticResource HoverBorderAccentBrush}"/>
                                </ObjectAnimationUsingKeyFrames>
                            </Storyboard>
                        </VisualState>
                        <VisualState x:Name="Pressed">
                            <Storyboard>
                                <ObjectAnimationUsingKeyFrames Storyboard.TargetProperty="(Shape.Fill)" Storyboard.TargetName="path">
                                    <DiscreteObjectKeyFrame KeyTime="0" Value="{StaticResource HoverBorderAccentBrush}"/>
                                </ObjectAnimationUsingKeyFrames>
                            </Storyboard>
                        </VisualState>
                        <VisualState x:Name="Disabled"/>
                    </VisualStateGroup>
                </VisualStateManager.VisualStateGroups>
                <Rectangle x:Name="rectangle" HorizontalAlignment="Left" Height="20" VerticalAlignment="Top" Width="40" Fill="{DynamicResource BackgroundColorBrush}"/>
                <Path x:Name="path" Fill="{DynamicResource BorderBrush}" HorizontalAlignment="Center" Height="22" VerticalAlignment="Center" Data="M11.558,0 L16.619999,0 16.619999,11.558 28.178,11.558 28.178,16.620001 16.619999,16.620001 16.619999,28.178 11.558,28.178 11.558,16.620001 0,16.620001 0,11.558 11.558,11.558 z" Margin="-0.821,-0.694,-0.728,-0.412" RenderTransformOrigin="0.499999978204051,0.500000009945565" Stretch="Fill" Width="22">
                    <Path.RenderTransform>
                        <TransformGroup>
                            <ScaleTransform/>
                            <SkewTransform/>
                            <RotateTransform Angle="45"/>
                            <TranslateTransform/>
                        </TransformGroup>
                    </Path.RenderTransform>
                </Path>
            </Grid>
        </ControlTemplate>
        <ControlTemplate x:Key="RestoreSize" TargetType="{x:Type Button}">
            <Grid Width="40" Height="20" WindowChrome.IsHitTestVisibleInChrome="True">
                <VisualStateManager.VisualStateGroups>
                    <VisualStateGroup x:Name="CommonStates">
                        <VisualState x:Name="Normal"/>
                        <VisualState x:Name="MouseOver">
                            <Storyboard>
                                <ObjectAnimationUsingKeyFrames Storyboard.TargetProperty="(Shape.Stroke)" Storyboard.TargetName="rectangle">
                                    <DiscreteObjectKeyFrame KeyTime="0" Value="{StaticResource HoverBorderAccentBrush}"/>
                                </ObjectAnimationUsingKeyFrames>
                            </Storyboard>
                        </VisualState>
                        <VisualState x:Name="Pressed">
                            <Storyboard>
                                <ObjectAnimationUsingKeyFrames Storyboard.TargetProperty="(Shape.Stroke)" Storyboard.TargetName="rectangle">
                                    <DiscreteObjectKeyFrame KeyTime="0" Value="{StaticResource HoverBorderAccentBrush}"/>
                                </ObjectAnimationUsingKeyFrames>
                            </Storyboard>
                        </VisualState>
                        <VisualState x:Name="Disabled"/>
                    </VisualStateGroup>
                </VisualStateManager.VisualStateGroups>
                <Rectangle Fill="{DynamicResource BackgroundColorBrush}" HorizontalAlignment="Left" Height="20" StrokeThickness="4" VerticalAlignment="Top" Width="40"/>
                <Rectangle x:Name="rectangle" Fill="{DynamicResource BackgroundColorBrush}" HorizontalAlignment="Center" Height="20" Stroke="{DynamicResource BorderBrush}" VerticalAlignment="Center" Width="20" Margin="2" StrokeThickness="4"/>
            </Grid>
        </ControlTemplate>
    </Window.Resources>

    <WindowChrome.WindowChrome>
        <WindowChrome ResizeBorderThickness="6" CaptionHeight="43" CornerRadius="{DynamicResource BigCornerRadius}" UseAeroCaptionButtons="True"  />
    </WindowChrome.WindowChrome>

    <Border Background="{DynamicResource BackgroundColorBrush}" BorderThickness="1" BorderBrush="{DynamicResource ControlBackgroundBrush}">
        <Grid>
            <Grid.RowDefinitions>
                <RowDefinition Height="Auto"/>
                <RowDefinition/>
            </Grid.RowDefinitions>
            <Border Padding="5,2">
                <Grid>
                    <Grid.RowDefinitions>
                        <RowDefinition />
                        <RowDefinition />
                    </Grid.RowDefinitions>
                    <Grid.ColumnDefinitions>
                        <ColumnDefinition Width="*"/>
                        <ColumnDefinition Width="Auto"/>
                        <ColumnDefinition Width="Auto"/>
                    </Grid.ColumnDefinitions>
                    <StackPanel Orientation="Horizontal" Margin="5,0" VerticalAlignment="Center" Grid.Column="0">
                        <!--todo: Icon-->
                        <TextBlock Text="{Binding Title}" FontWeight="Bold" Foreground="{DynamicResource ForegroundBrush}" VerticalAlignment="Center"/>
                    </StackPanel>
                    <StackPanel Orientation="Horizontal" Grid.Row="0" Grid.Column="1" HorizontalAlignment="Right" Margin="0,3,5,2">
                        <Button Template="{DynamicResource Minimize}" Click="MinimizeOnClick" Width="40" />
                        <Button Template="{DynamicResource RestoreSize}" Click="RestoreOnClick" Width="40"/>
                        <Button Template="{DynamicResource Close}" Click="CloseOnClick" Width="40"/>
                    </StackPanel>
                    <Separator Grid.ColumnSpan="3" Grid.Column="0" Grid.Row="1" Margin="5,0"/>
                </Grid>
            </Border>
            <Grid Grid.Row="1">
                <Grid.ColumnDefinitions>
                    <ColumnDefinition Width="auto" MinWidth="120"/>
                    <ColumnDefinition Width="*"/>
                </Grid.ColumnDefinitions>
                <Grid.RowDefinitions>
                    <RowDefinition Height="*"/>
                    <RowDefinition Height="Auto"/>
                </Grid.RowDefinitions>

                <ItemsControl Grid.Column="0" Grid.Row="0" ItemsSource="{Binding ViewModels}" Margin="5,0" VerticalAlignment="Top" HorizontalAlignment="Center">
                    <ItemsControl.ItemTemplate>
                        <DataTemplate>
                            <!-- ReSharper disable Xaml.BindingWithContextNotResolved -->
                            <Button Content="{Binding Key}"
                                Command="{Binding DataContext.SetViewModelCommand, RelativeSource={RelativeSource AncestorType={x:Type Window}}}"
                                CommandParameter="{Binding Value}" Margin="5,5,5,2"/>
                            <!-- ReSharper restore Xaml.BindingWithContextNotResolved -->
                        </DataTemplate>
                    </ItemsControl.ItemTemplate>
                </ItemsControl>
                <stocks:StockSummaryView Grid.Column="0" Grid.Row="1" Content="{Binding SummaryViewModel}" Margin="5,25,5,0" VerticalAlignment="Top" MaxWidth="150"/>

                <UserControl Grid.Column="1" Grid.Row="0" Grid.RowSpan="2" Content="{Binding SelectedViewModel}" Margin="2,0"/>
            </Grid>
        </Grid>
    </Border>
</Window>

